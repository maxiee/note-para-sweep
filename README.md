### **产品文档：Note PARA Sweep**

**版本：1.0**
**日期：** 2023年10月27日
**作者：** 你 & 你的 AI 合作伙伴

---

#### **1. 项目愿景 (Vision)**

**目标：** 开发一个智能的、交互式的 AI Agent，帮助 Obsidian 用户根据个性化的 PARA 方法论，高效地分类笔记、优化知识库结构。

**核心理念：** 本工具并非一个强制性的“自动分类器”，而是一个理解用户知识体系、提供专业建议、并在用户完全控制下执行操作的“智能图书管理员”和“知识架构顾问”。

---

#### **2. 目标用户 (Target User)**

*   **身份：** Obsidian 笔记软件的用户。
*   **背景：** 正在学习或已经在使用 PARA 笔记法来组织自己的数字笔记。
*   **需求：**
    *   希望减少手动整理和归类笔记的认知负担。
    *   需要一个能理解其现有目录结构，并给出“上下文感知”建议的工具。
    *   对 AI 技术感兴趣，并希望将其应用于个人知识管理。
*   **痛点：**
    *   新笔记堆积在“收件箱”，整理不及时。
    *   在为一篇笔记寻找最佳存放位置时感到犹豫不决。
    *   感觉现有的 PARA 目录结构可能不是最优的，但不知如何下手改进。
    *   担心自动化工具会误操作，导致宝贵的笔记数据丢失或混乱。

---

#### **3. 设计原则 (Core Principles)**

1.  **安全第一 (Safety First):** 任何对文件系统的修改（移动、重命名、创建）都必须有明确的、可追溯的日志。默认情况下，不执行任何破坏性操作。
2.  **用户主导 (User in Control):** AI 只提供建议，最终决策权完全在用户手中。每一个重要操作都必须经过用户的明确确认（例如，输入 `y/n`）。
3.  **上下文感知 (Context-Aware):** Agent 的核心智能来源于对用户现有 PARA 目录结构的理解。所有建议都应基于已存在的知识体系，而非凭空产生。
4.  **透明可交互 (Transparent & Interactive):** 用户需要清楚地知道 AI 做出某个建议的理由。整个过程应是与用户对话式的，而非一个黑箱。

---

#### **4. 功能规格 (Features)**

**4.1 基础功能：配置与环境**

*   **F1.1 - 配置文件 (`config.yaml`):**
    *   用户可以通过一个简单的 YAML 文件配置 Obsidian 库的根路径。
    *   用户可以在此文件中指定其 Projects, Areas, Resources, Archives 四个顶级目录的名称和路径。
    *   用户需要在此填入自己的 OpenAI API Key。

**4.2 核心功能：单笔记智能分类**

*   **F2.1 - 交互式输入:** 程序启动后，通过命令行提示用户输入待分类的笔记文件路径。
*   **F2.2 - 目录结构扫描:** Agent 首先扫描用户配置的 PARA 目录，生成一个实时的“目录地图”作为 AI 分析的上下文。
*   **F2.3 - AI 智能分析:**
    *   Agent 将笔记内容（标题、正文）和“目录地图”一同发送给大语言模型（LLM）。
    *   通过精心设计的 Prompt，引导 LLM 给出最合适的存放路径建议，包括可能需要创建的新子目录。
*   **F2.4 - 清晰的建议呈现:** Agent 将 AI 的建议格式化后展示给用户，必须包含：
    *   **建议的目标路径。**
    *   **AI 做出此建议的详细理由。**
    *   **即将执行的操作类型（如：文件移动，创建目录）。**
*   **F2.5 - 用户确认机制:** 在展示建议后，程序会暂停并等待用户输入 `y` (是) 或 `n` (否) 进行确认。只有在用户确认后，才执行文件操作。

**4.3 高级功能：知识库结构优化**

*   **F3.1 - 优化模式触发:** 用户可以通过特定的启动命令（如 `python agent.py --optimize`）进入此模式。
*   **F3.2 - 全局结构分析:** Agent 扫描整个 PARA 结构（可配置扫描深度或只扫描文件名），将整体布局信息发送给 LLM。
*   **F3.3 - 架构优化建议:** LLM 会从更高维度分析知识库的合理性，并可能提出以下建议：
    *   重命名文件夹以提高清晰度。
    *   移动整个项目文件夹（例如，从 Resources 到 Areas）。
    *   合并主题相似的文件夹。
*   **F3.4 - 逐条交互确认:** Agent 会逐一展示优化建议及其理由，并让用户对每一条建议进行 `y/n/skip` (是/否/跳过) 的选择。

**4.4 安全与体验**

*   **F4.1 - 试运行模式 (Dry Run):** 提供一个 `dry-run` 标志，在此模式下，Agent 会完整地执行所有分析和建议流程，但只打印将要执行的操作，而不实际触碰文件系统。这是调试和建立信任的关键功能。
*   **F4.2 - 操作日志:** 所有被用户确认并执行的操作，都会被记录到一个日志文件 (`log.txt`) 中，方便用户追溯历史记录。

---

#### **5. 技术栈 (Technical Stack)**

*   **语言:** Python 3.x
*   **核心库:**
    *   `openai`: 与 OpenAI API 交互。
    *   `PyYAML`: 解析 `config.yaml` 配置文件。
    *   `os`, `shutil`: 用于文件和目录操作。
*   **运行环境:** 本地命令行终端。

---

#### **6. 开发路线图 (Roadmap)**

*   **第一阶段：地基与配置 (Foundation & Configuration)**
    *   实现 `config.yaml` 的读取。
    *   实现 PARA 目录的扫描与“目录地图”生成功能。
*   **第二阶段：核心 AI 分类器 (Core AI Classifier)**
    *   实现单笔记的读取与分析。
    *   构建核心 Prompt V1。
    *   实现交互式的建议与确认流程。
*   **第三阶段：高级 AI 架构师 (Advanced AI Architect)**
    *   开发 `--optimize` 模式。
    *   构建用于结构优化的 Meta-Prompt。
    *   实现逐条优化建议的交互流程。
*   **第四阶段：集成与优化 (Integration & UX)**
    *   实现 `dry-run` 模式和日志记录。
    *   探索与 Obsidian 插件（如 Shell Commands）的集成方案。
    *   根据使用反馈进行 Prompt 调优和流程优化。

---

这份文档就是我们接下来合作的基石。请仔细阅读，看看是否有任何遗漏或需要修改的地方。

**如果这份文档准确地描绘了你心中的那个工具，请给我一个“确认”，我们就可以立刻开始动手，编写第一阶段的代码了！**